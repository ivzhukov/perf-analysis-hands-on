<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-baseline" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Baseline measurement | Performance Analysis</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/perf-analysis-hands-on/docs/baseline"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Baseline measurement | Performance Analysis"><meta data-rh="true" name="description" content="In this part we are going to build and run a specific benchmark to identify how long it runs without any specific tools (also called as a reference/baseline run). A reference run provides a valuable point of comparison and context for performance analysis, enabling more informed decision-making and effective optimization efforts."><meta data-rh="true" property="og:description" content="In this part we are going to build and run a specific benchmark to identify how long it runs without any specific tools (also called as a reference/baseline run). A reference run provides a valuable point of comparison and context for performance analysis, enabling more informed decision-making and effective optimization efforts."><link data-rh="true" rel="icon" href="/perf-analysis-hands-on/img/logo.ico"><link data-rh="true" rel="canonical" href="https://github.com/perf-analysis-hands-on/docs/baseline"><link data-rh="true" rel="alternate" href="https://github.com/perf-analysis-hands-on/docs/baseline" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/perf-analysis-hands-on/docs/baseline" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/perf-analysis-hands-on/blog/rss.xml" title="Performance Analysis RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/perf-analysis-hands-on/blog/atom.xml" title="Performance Analysis Atom Feed"><link rel="stylesheet" href="/perf-analysis-hands-on/assets/css/styles.860945d0.css">
<script src="/perf-analysis-hands-on/assets/js/runtime~main.0379b49e.js" defer="defer"></script>
<script src="/perf-analysis-hands-on/assets/js/main.f9e18743.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/perf-analysis-hands-on/"><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/perf-analysis-hands-on/docs/baseline">Hands-On</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/perf-analysis-hands-on/docs/baseline">Baseline measurement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/perf-analysis-hands-on/docs/instrumentation">Instrumentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/perf-analysis-hands-on/docs/filtering">Filtering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/perf-analysis-hands-on/docs/profile_exploration">Explore profile with CUBE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/perf-analysis-hands-on/docs/trace_analysis">Scalasca trace analysis</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/perf-analysis-hands-on/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Baseline measurement</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Baseline measurement</h1>
<p>In this part we are going to build and run a specific benchmark to identify how long it runs without any specific tools (also called as a reference/baseline run). A reference run provides a valuable point of comparison and context for performance analysis, enabling more informed decision-making and effective optimization efforts.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="initial-setup">Initial setup<a href="#initial-setup" class="hash-link" aria-label="Direct link to Initial setup" title="Direct link to Initial setup">â€‹</a></h2>
<p>First of all let&#x27;s login into CoolMUC-2 using ssh:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-Y</span><span class="token plain"> userid@lxlogin1.lrz.de</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <strong>-Y</strong> option is necessary to enable X11 forwarding. X11 forwarding is a SSH protocol that enables users to run graphical applications on a remote server and interact with them using their local display and I/O devices.</p>
<p>Now we need to create our own directory for the exercises:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/tw45</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <strong>-p</strong> prevents error messages if the specified directories already exists.</p>
<p>Then, we need to load required software, e.g. compiler, MPI, text editor:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ module load intel intel-mpi/2019-intel </span><span class="token function" style="color:#d73a49">nano</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-benchmark">Build benchmark<a href="#build-benchmark" class="hash-link" aria-label="Direct link to Build benchmark" title="Direct link to Build benchmark">â€‹</a></h2>
<p>Start by copying the tutorial sources to your working directory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/tw45</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zxvf /lrz/sys/courses/vihps/2024/material/NPB3.3-MZ-MPI.tar.gz </span><span class="token parameter variable" style="color:#36acaa">-C</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/tw45/NPB3.3-MZ-MPI</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For this tutorial we are going to use the NAS Parallel Benchmark suite (MPI+OpenMP version). It is available <a href="http://www.nas.nasa.gov/Software/NPB" target="_blank" rel="noopener noreferrer">here</a>, and includes three benchmarks written in Fortran77. You can configure the benchmark for various sizes and classes. This allows the benchmark to be used on a wide range of systems, from workstations to supercomputers.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>NPB solves discretized versions of the unsteady, compressible Navier-Stokes equations in three spatial dimensions. Each operates on a structured discretization mesh that is a logical cube. In realistic applications, however, a single such mesh is often not sufficient to describe a complex domain, and multiple meshes or zones are used to cover it.</p><p>Multi-zone versions of NPB (NPB-MZ) are designed to exploit multiple levels of parallelism in applications and to test the effectiveness of multi-level and hybrid parallelization paradigms and tools. There are three types of benchmark problems derived from single-zone pseudo applications of NPB:</p><ul>
<li><strong>Block Tri-diagonal (BT)</strong> - uneven-sized zones within a problem class, increased number of zones as problem class grows</li>
<li><strong>Scalar Penta-diagonal (SP)</strong> - even-sized zones within a problem class, increased number of zones as problem class grows</li>
<li><strong>Lower-Upper Symmetric Gauss-Seidel (LU)</strong> - even-sized zones within a problem class, a fixed number of zones for all problem classes</li>
</ul><p>Benchmark Classes</p><ul>
<li>Class <strong>S</strong>: small for quick test purposes</li>
<li>Class <strong>W</strong>: workstation size (a 90&#x27;s workstation; now likely too small)</li>
<li>Classes <strong>A</strong>, <strong>B</strong>, <strong>C</strong>: standard test problems; ~4X size increase going from one class to the next</li>
<li>Classes <strong>D</strong>, <strong>E</strong>, <strong>F</strong>: large test problems; ~16X size increase from each of the previous classes</li>
</ul><p>MPI is used for communication across zones and OpenMP threads for computation inside zones. More technical details are provided in this <a href="https://www.nas.nasa.gov/assets/nas/pdf/techreports/2003/nas-03-010.pdf" target="_blank" rel="noopener noreferrer">paper</a>.</p></div></div>
<p>Move into the NPB3.3-MZ-MPI root directory and check what is inside:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bin/    common/  jobscript/  Makefile  README.install   SP-MZ/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BT-MZ/  config/  LU-MZ/      README    README.tutorial  sys/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Subdirectories <code>BT-MZ</code>, <code>LU-MZ</code> and <code>SP-MZ</code> contain source code for each benchmark, <code>config</code> and <code>common</code> include additional configuration and common code. The provided distribution has already been configured for the hands-on, such that it is ready to be build.</p>
<p>During this hands-on we will focus on <code>BT-MZ</code> exercise. It performs 200 time-steps on a regular 3-dimensional grid. It uses combination of MPI and OpenMP.</p>
<p>Type <code>make</code> for instructions</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ===========================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   =      NAS PARALLEL BENCHMARKS 3.3        =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   =      MPI+OpenMP Multi-Zone Versions     =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   =      F77                                =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ===========================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   To make a NAS multi-zone benchmark type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         make &lt;benchmark-name&gt; CLASS=&lt;class&gt; NPROCS=&lt;nprocs&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   where &lt;benchmark-name&gt; is &quot;bt-mz&quot;, &quot;lu-mz&quot;, or &quot;sp-mz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &lt;class&gt;          is &quot;S&quot;, &quot;W&quot;, &quot;A&quot; through &quot;F&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &lt;nprocs&gt;         is number of processes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   To make a set of benchmarks, create the file config/suite.def</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   according to the instructions in config/suite.def.template and type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         make suite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ***************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Custom build configuration is specified in config/make.def  *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Suggested tutorial exercise configuration for LiveDVD:      *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *       make bt-mz CLASS=W NPROCS=4                           *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ***************************************************************</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To build application the following parameters need to be specified:</p>
<ul>
<li>The benchmark configuration benchmark name (bt-mz, lu-mz, sp-mz): <code>bt-mz</code></li>
<li>The number of MPI processes: <code>NPROCS=28</code></li>
<li>The benchmark class (S, W, A, B, C, D, E): <code>CLASS=C</code></li>
</ul>
<p>Alternatively, you can just use <code>make suite</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> bt-mz </span><span class="token assign-left variable" style="color:#36acaa">CLASS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">C </span><span class="token assign-left variable" style="color:#36acaa">NPROCS</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">      NAS PARALLEL BENCHMARKS </span><span class="token number" style="color:#36acaa">3.3</span><span class="token plain">        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">      MPI+OpenMP Multi-Zone Versions     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">      F77                                </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> BT-MZ</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CLASS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">C </span><span class="token assign-left variable" style="color:#36acaa">NPROCS</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">VERSION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Entering directory </span><span class="token string" style="color:#e3116c">&#x27;/dss/dsshome1/0C/hpckurs11/tw45/NPB3.3-MZ-MPI/BT-MZ&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Entering directory </span><span class="token string" style="color:#e3116c">&#x27;/dss/dsshome1/0C/hpckurs11/tw45/NPB3.3-MZ-MPI/sys&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc  </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> setparams setparams.c </span><span class="token parameter variable" style="color:#36acaa">-lm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Leaving directory </span><span class="token string" style="color:#e3116c">&#x27;/dss/dsshome1/0C/hpckurs11/tw45/NPB3.3-MZ-MPI/sys&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/sys/setparams bt-mz </span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Entering directory </span><span class="token string" style="color:#e3116c">&#x27;/dss/dsshome1/0C/hpckurs11/tw45/NPB3.3-MZ-MPI/BT-MZ&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 bt.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 initialize.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 exact_solution.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 exact_rhs.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 set_constants.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 adi.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 rhs.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 zone_setup.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 x_solve.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 y_solve.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 exch_qbc.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 solve_subs.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 z_solve.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 add.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 error.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 verify.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 mpi_setup.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/common</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 print_results.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/common</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> mpif77 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 timers.f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpif77 </span><span class="token parameter variable" style="color:#36acaa">-O3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qopenmp</span><span class="token plain">	 </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/bt-mz_C.28 bt.o  initialize.o exact_solution.o exact_rhs.o set_constants.o adi.o  rhs.o zone_setup.o x_solve.o y_solve.o  exch_qbc.o solve_subs.o z_solve.o add.o error.o verify.o mpi_setup.o </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/common/print_results.o </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/common/timers.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Leaving directory </span><span class="token string" style="color:#e3116c">&#x27;/dss/dsshome1/0C/hpckurs11/tw45/NPB3.3-MZ-MPI/BT-MZ&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Built executable </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/bt-mz_C.28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Leaving directory </span><span class="token string" style="color:#e3116c">&#x27;/dss/dsshome1/0C/hpckurs11/tw45/NPB3.3-MZ-MPI/BT-MZ&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If compilation succeeds, you can find in the <code>bin</code> directory.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-benchmark">Run benchmark<a href="#run-benchmark" class="hash-link" aria-label="Direct link to Run benchmark" title="Direct link to Run benchmark">â€‹</a></h2>
<p>Lets go to the <code>bin</code> directory, copy a prepared batch script and examine what it does:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/jobscript/coolmuc2/reference.sbatch </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> reference.sbatch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here is what you should see in your batch script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH -o bt-mz.%j.out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH -e bt-mz.%j.err</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH -J bt-mz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH --clusters=cm2_tiny</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH --partition=cm2_tiny</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH --reservation=hhps1s24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH --nodes=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH --ntasks=28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH --ntasks-per-node=14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH --get-user-env</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#SBATCH --time=00:05:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">OMP_NUM_THREADS</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Benchmark configuration (disable load balancing with threads)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NPB_MZ_BLOAD</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PROCS</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CLASS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Run the application</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpiexec </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$SLURM_NTASKS</span><span class="token plain"> ./bt-mz_</span><span class="token variable" style="color:#36acaa">$CLASS</span><span class="token builtin class-name">.</span><span class="token variable" style="color:#36acaa">$PROCS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To exit text editor you can use <code>Ctrl+X</code></p>
<p>On CoolMUC-2 we are going to use:</p>
<ul>
<li>2 standard compute nodes with 2x Intel Haswell 14-Core Processor each (28 cores / 56 threads)</li>
<li>56GB RAM per node</li>
<li>14 MPI ranks per node and 4 OpenMP threads per MPI rank</li>
</ul>
<p>Now we are ready to submit our batch script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sbatch reference.sbatch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>To submit the job use <code>sbatch &lt;script you want to submit&gt;</code>.</p><p>To check status of all your jobs use <code>squeue -M cm2_tiny --me</code>.</p><p>To cancel specific job use <code>scancel -M cm2_tiny &lt;jobid you want to cancel&gt;</code>.</p></div></div>
<p>Once the job has finished you will see two files in your directory, one with standard output <code>bt-mz.&lt;jobid&gt;.out</code> and one with standard error output <code>bt-mz.&lt;jobid&gt;.err</code>. The former one should include all output provided by your application and the latter one only system specific output. Let&#x27;s examine standard output file:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat bt-mz.&lt;jobid&gt;.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAS Parallel Benchmarks (NPB3.3-MZ-MPI) - BT-MZ MPI+OpenMP Benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Number of zones:  16 x  16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iterations: 200    dt:   0.000100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Number of active processes:    28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Use the default load factors with threads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total number of threads:    112  (  4.0 threads/process)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Calculated speedup =    110.34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step    1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step   20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step   40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step   60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step   80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step  100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step  120</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step  140</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step  160</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step  180</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time step  200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Verification being performed for class C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accuracy setting for epsilon =  0.1000000000000E-07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Comparison of RMS-norms of residual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          1 0.3457703287806E+07 0.3457703287806E+07 0.1092202750127E-12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          2 0.3213621375929E+06 0.3213621375929E+06 0.1320422658492E-12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          3 0.7002579656870E+06 0.7002579656870E+06 0.1496217033982E-13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          4 0.4517459627471E+06 0.4517459627471E+06 0.2280652586031E-13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          5 0.2818715870791E+07 0.2818715870791E+07 0.1486830094937E-14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Comparison of RMS-norms of solution error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          1 0.2059106993570E+06 0.2059106993570E+06 0.1540627820550E-12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          2 0.1680761129461E+05 0.1680761129461E+05 0.2132015705369E-12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          3 0.4080731640795E+05 0.4080731640795E+05 0.3084595553087E-13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          4 0.2836541076778E+05 0.2836541076778E+05 0.1026032398931E-12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          5 0.2136807610771E+06 0.2136807610771E+06 0.2335870996607E-12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Verification Successful</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BT-MZ Benchmark Completed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Class           =                        C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Size            =            480x  320x 28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iterations      =                      200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time in seconds =                    13.91</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total processes =                       28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total threads   =                      112</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mop/s total     =                174439.35</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mop/s/thread    =                  1557.49</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Operation type  =           floating point</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Verification    =               SUCCESSFUL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Version         =                    3.3.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Compile date    =              04 Jun 2024</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The most important metric in the output is &quot;Time in seconds&quot; which indicates how much time the application spent executing 200 iterations (pre and post. processing are excluded from the time measurement). Further, &quot;Validation&quot; is important as it indicates if the computation completed successfully (e.g. converged). Please write down the time value you received, as we are going to refer to its value in the next section.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>For time measurements you can use <code>time</code> utility which is used to measure the execution time of a program or command. It provides information about how long a particular process took to execute, including user time, system time, and real time, i.e.</p><ul>
<li><strong>User time</strong> is the time spent executing user-space instructions.</li>
<li><strong>System time</strong> is the time spent executing system calls.</li>
<li><strong>Real time</strong> is the actual time elapsed from start to finish, including all waiting and execution time.</li>
</ul><p>It&#x27;s a handy tool for performance analysis and optimization.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Question</div><div class="admonitionContent_BuS1"><p>In this exercise we measured the basic performance metric, i.e. walltime. What else do you think can be used to measure the performance of the application in general and of the code you are working on?</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--next" href="/perf-analysis-hands-on/docs/instrumentation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Instrumentation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#initial-setup" class="table-of-contents__link toc-highlight">Initial setup</a></li><li><a href="#build-benchmark" class="table-of-contents__link toc-highlight">Build benchmark</a></li><li><a href="#run-benchmark" class="table-of-contents__link toc-highlight">Run benchmark</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://score-p.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Score-P<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.scalasca.org/scalasca/software/cube-4.x/download.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">CUBE<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.scalasca.org/scalasca/software/scalasca-2.x/download.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scalasca<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Useful Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.vi-hps.org/training/tws/tw45.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Agenda</a></li><li class="footer__item"><a href="https://tinyurl.com/vihps-2024" target="_blank" rel="noopener noreferrer" class="footer__link-item">TW45 info</a></li><li class="footer__item"><a href="https://www.vi-hps.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">VI-HPS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://pop-coe.eu" target="_blank" rel="noopener noreferrer" class="footer__link-item">POP CoE<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://eurohpc-ju.europa.eu/epicure-new-ri-project-launched-eurohpc-ju-2024-02-07_en" target="_blank" rel="noopener noreferrer" class="footer__link-item">EPICURE<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Forschungszentrum JÃ¼lich</div></div></div></footer></div>
</body>
</html>